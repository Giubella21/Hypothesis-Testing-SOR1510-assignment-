%box plot fix:

# Since your data already has proper labels, use this simple code:
data <- raw_data  # Use your already loaded data

# Create a directory for plots
plot_dir <- "C:/Users/giumo/OneDrive/Documents/Plasma_Plots"
if (!dir.exists(plot_dir)) {
  dir.create(plot_dir)
  cat("Created plot directory:", plot_dir, "\n")
}

# Function to save boxplots
create_boxplot <- function(y_var, group_var, title, filename) {
  # Create full path
  full_path <- file.path(plot_dir, filename)
  
  # Start PNG device
  png(full_path, width = 800, height = 600)
  
  # Create the boxplot
  boxplot(formula(paste(y_var, "~", group_var)), 
          data = data,
          main = title,
          xlab = "",
          ylab = ifelse(y_var == "BETAPLASMA", "Plasma Beta-Carotene (ng/ml)",
                       ifelse(y_var == "RETPLASMA", "Plasma Retinol (ng/ml)", 
                              ifelse(y_var == "AGE", "Age (years)", y_var))),
          col = ifelse(group_var == "SEX", 
                      c("lightblue", "lightpink"),
                      ifelse(group_var == "SMOKSTAT",
                            c("lightgreen", "lightyellow", "lightcoral"),
                            c("lightblue", "lightgreen", "lightyellow"))),
          cex.main = 1.5,  # Larger title
          cex.lab = 1.2)   # Larger axis labels
  
  # Add x-axis label
  mtext(switch(group_var,
               "SEX" = "Sex",
               "SMOKSTAT" = "Smoking Status",
               "VITUSE" = "Vitamin Use Frequency"),
        side = 1, line = 2.5, cex = 1.2)
  
  # Close device
  dev.off()
  
  cat("Created:", filename, "\n")
}

# Create all boxplots
cat("\nCreating boxplots...\n")

# 1. Beta-Carotene plots
create_boxplot("BETAPLASMA", "SEX", 
               "Plasma Beta-Carotene by Sex",
               "boxplot_beta_sex.png")

create_boxplot("BETAPLASMA", "SMOKSTAT",
               "Plasma Beta-Carotene by Smoking Status",
               "boxplot_beta_smoking.png")

create_boxplot("BETAPLASMA", "VITUSE",
               "Plasma Beta-Carotene by Vitamin Use",
               "boxplot_beta_vitamin.png")

# 2. Retinol plots
create_boxplot("RETPLASMA", "SEX",
               "Plasma Retinol by Sex",
               "boxplot_retinol_sex.png")

create_boxplot("RETPLASMA", "SMOKSTAT",
               "Plasma Retinol by Smoking Status",
               "boxplot_retinol_smoking.png")

create_boxplot("RETPLASMA", "VITUSE",
               "Plasma Retinol by Vitamin Use",
               "boxplot_retinol_vitamin.png")

# 3. Age plots
create_boxplot("AGE", "SEX",
               "Age Distribution by Sex",
               "boxplot_age_sex.png")

create_boxplot("AGE", "SMOKSTAT",
               "Age by Smoking Status",
               "boxplot_age_smoking.png")

# Also create histograms for key variables
cat("\nCreating histograms...\n")

create_histogram <- function(var, title, filename) {
  full_path <- file.path(plot_dir, filename)
  png(full_path, width = 800, height = 600)
  
  hist(data[[var]],
       main = title,
       xlab = switch(var,
                    "BETAPLASMA" = "Plasma Beta-Carotene (ng/ml)",
                    "RETPLASMA" = "Plasma Retinol (ng/ml)",
                    "AGE" = "Age (years)",
                    "ALCOHOL" = "Alcoholic Drinks per Week",
                    var),
       ylab = "Frequency",
       col = "lightblue",
       border = "black",
       breaks = 20,
       cex.main = 1.5,
       cex.lab = 1.2)
  
  # Add density curve
  dens <- density(data[[var]], na.rm = TRUE)
  lines(dens$x, dens$y * length(data[[var]]) * diff(hist(data[[var]], plot = FALSE)$breaks)[1], 
        col = "red", lwd = 2)
  
  dev.off()
  cat("Created:", filename, "\n")
}

# Create key histograms
create_histogram("BETAPLASMA", "Distribution of Plasma Beta-Carotene", "histogram_beta.png")
create_histogram("RETPLASMA", "Distribution of Plasma Retinol", "histogram_retinol.png")
create_histogram("AGE", "Distribution of Age", "histogram_age.png")
create_histogram("ALCOHOL", "Distribution of Alcohol Consumption", "histogram_alcohol.png")

# Create scatterplots
cat("\nCreating scatterplots...\n")

create_scatterplot <- function(x_var, y_var, title, filename) {
  full_path <- file.path(plot_dir, filename)
  png(full_path, width = 800, height = 600)
  
  plot(data[[x_var]], data[[y_var]],
       main = title,
       xlab = switch(x_var,
                    "BETADIET" = "Dietary Beta-Carotene (mcg/day)",
                    "RETDIET" = "Dietary Retinol (mcg/day)",
                    "AGE" = "Age (years)",
                    "QUETELET" = "Quetelet Index (kg/mÂ²)",
                    x_var),
       ylab = switch(y_var,
                    "BETAPLASMA" = "Plasma Beta-Carotene (ng/ml)",
                    "RETPLASMA" = "Plasma Retinol (ng/ml)",
                    y_var),
       pch = 19,  # Solid circles
       col = rgb(0, 0, 1, 0.5),  # Semi-transparent blue
       cex = 1.2,
       cex.main = 1.5,
       cex.lab = 1.2)
  
  # Add regression line
  if(sum(!is.na(data[[x_var]]) & !is.na(data[[y_var]])) > 2) {
    abline(lm(data[[y_var]] ~ data[[x_var]]), 
           col = "red", lwd = 2)
  }
  
  dev.off()
  cat("Created:", filename, "\n")
}

# Create key scatterplots
create_scatterplot("BETADIET", "BETAPLASMA", 
                   "Dietary vs Plasma Beta-Carotene",
                   "scatter_beta_diet_vs_plasma.png")

create_scatterplot("RETDIET", "RETPLASMA",
                   "Dietary vs Plasma Retinol",
                   "scatter_retinol_diet_vs_plasma.png")

create_scatterplot("AGE", "RETPLASMA",
                   "Age vs Plasma Retinol",
                   "scatter_age_vs_retinol.png")

create_scatterplot("QUETELET", "BETAPLASMA",
                   "Quetelet Index vs Beta-Carotene",
                   "scatter_quetelet_vs_beta.png")

# Summary statistics
cat("\n=== Summary Statistics ===\n")
cat("Total observations:", nrow(data), "\n\n")

cat("Age summary:\n")
print(summary(data$AGE))
cat("SD:", sd(data$AGE), "\n\n")

cat("Plasma Beta-Carotene summary:\n")
print(summary(data$BETAPLASMA))
cat("SD:", sd(data$BETAPLASMA), "\n\n")

cat("Plasma Retinol summary:\n")
print(summary(data$RETPLASMA))
cat("SD:", sd(data$RETPLASMA), "\n\n")

cat("Sex distribution:\n")
print(table(data$SEX))
cat("Percentage female:", round(100 * sum(data$SEX == "Female") / nrow(data), 1), "%\n\n")

cat("Smoking status distribution:\n")
print(table(data$SMOKSTAT))
cat("\n")

cat("Vitamin use distribution:\n")
print(table(data$VITUSE))

cat("\n=== All plots saved to:", plot_dir, "===\n")
cat("You should now have 15 PNG files ready for your report.\n")


